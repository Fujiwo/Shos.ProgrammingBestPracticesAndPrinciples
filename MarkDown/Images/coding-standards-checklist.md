# コーディング規約チェックリスト集

## 命名規則チェックリスト

### クラス・インターフェース命名

| チェック項目 | 良い例 | 悪い例 | 説明 |
|-------------|--------|--------|------|
| **名詞または名詞句** | `CustomerService` | `ProcessCustomer` | クラスは物や概念を表す |
| **PascalCase** | `OrderManager` | `orderManager` | 各単語の先頭を大文字 |
| **意図を表現** | `EmailValidator` | `Validator` | 具体的な責務を示す |
| **省略語を避ける** | `CustomerRepository` | `CustRepo` | 完全な単語を使用 |
| **Interfaceプレフィックス** | `IPaymentService` | `PaymentServiceInterface` | I + 実装クラス名 |

### メソッド命名

| チェック項目 | 良い例 | 悪い例 | 説明 |
|-------------|--------|--------|------|
| **動詞で開始** | `CalculateTotal()` | `Total()` | 何をするかを明確に |
| **camelCase** | `validateEmail()` | `ValidateEmail()` | 最初の文字は小文字 |
| **ブール値返却** | `IsValid()`, `CanProcess()` | `Valid()`, `Process()` | Is/Can/Has で開始 |
| **副作用を示す** | `SaveAndNotify()` | `Save()` | 複数の処理を明示 |
| **引数を説明** | `FindByEmail(string)` | `Find(string)` | 検索条件を明示 |

### 変数命名

| チェック項目 | 良い例 | 悪い例 | 説明 |
|-------------|--------|--------|------|
| **意味のある名前** | `customerCount` | `count` | 何をカウントするか明示 |
| **型情報を避ける** | `customers` | `customerList` | 型は別途宣言 |
| **短すぎる名前を避ける** | `index` | `i` | ループ以外では避ける |
| **否定形を避ける** | `isEnabled` | `isNotDisabled` | 肯定形で表現 |
| **一時変数の明確化** | `tempTotal` | `temp` | 一時的でも役割を示す |

## コード構造チェックリスト

### メソッド設計

| チェック項目 | 基準 | チェック方法 | 改善方法 |
|-------------|------|-------------|----------|
| **長さ** | 20行以内 | 行数カウント | メソッド分割 |
| **引数の数** | 3個以内 | パラメータ数確認 | パラメータオブジェクト導入 |
| **ネストレベル** | 3レベル以内 | インデント確認 | Early Return パターン |
| **単一責務** | 1つの機能のみ | 処理内容確認 | 責務分離 |
| **副作用** | 最小限 | 変更箇所確認 | 純粋関数化 |

### クラス設計

| チェック項目 | 基準 | チェック方法 | 改善方法 |
|-------------|------|-------------|----------|
| **クラスサイズ** | 200行以内 | 行数カウント | クラス分割 |
| **メソッド数** | 10個以内 | メソッド数確認 | 責務分離 |
| **依存関係** | 最小限 | using文確認 | 依存関係整理 |
| **凝集度** | 高い | メンバー関連性確認 | 関連機能のグループ化 |
| **結合度** | 低い | 他クラス参照確認 | インターフェース導入 |

## エラーハンドリングチェックリスト

### 例外処理

| チェック項目 | 良い例 | 悪い例 | 説明 |
|-------------|--------|--------|------|
| **適切な例外型** | `ArgumentNullException` | `Exception` | 具体的な例外型を使用 |
| **意味のあるメッセージ** | `"Email address is required"` | `"Error"` | 問題を具体的に説明 |
| **リソース解放** | `using` statement | `try-finally` | 確実なリソース管理 |
| **例外の再スロー** | `throw;` | `throw ex;` | スタックトレース保持 |
| **ログ出力** | 適切なレベルで記録 | 例外を無視 | 問題の追跡可能性 |

### 防御的プログラミング

| チェック項目 | 実装例 | 効果 |
|-------------|--------|------|
| **null チェック** | `if (value == null) throw new ArgumentNullException(nameof(value));` | NullReferenceException防止 |
| **引数検証** | `if (count < 0) throw new ArgumentOutOfRangeException(nameof(count));` | 不正値の早期検出 |
| **事前条件** | `Contract.Requires(items.Any());` | 前提条件の明確化 |
| **事後条件** | `Contract.Ensures(result != null);` | 結果の保証 |
| **不変条件** | `Contract.Invariant(count >= 0);` | オブジェクト状態の保証 |

## パフォーマンスチェックリスト

### 一般的なパフォーマンス

| チェック項目 | 問題のあるコード | 改善されたコード | 効果 |
|-------------|------------------|------------------|------|
| **文字列連結** | `str += item;` | `StringBuilder.Append(item);` | メモリ効率向上 |
| **コレクション初期化** | `new List<T>()` | `new List<T>(capacity)` | 再割り当て回避 |
| **LINQ vs ループ** | 複雑なLINQ | `foreach` | 可読性とパフォーマンス |
| **非同期処理** | `Task.Result` | `await task` | デッドロック回避 |
| **リソース管理** | 手動Close | `using` | 確実な解放 |

### データベースアクセス

| チェック項目 | 問題点 | 改善方法 | 効果 |
|-------------|--------|----------|------|
| **N+1問題** | ループ内でクエリ実行 | Eager Loading, Join | クエリ数削減 |
| **SELECT *** | 全カラム取得 | 必要カラムのみ指定 | 転送量削減 |
| **接続プール** | 接続の使い回し未実装 | Connection Pooling | 接続コスト削減 |
| **インデックス** | インデックス未設定 | 適切なインデックス作成 | 検索性能向上 |
| **トランザクション** | 長時間トランザクション | 適切な範囲設定 | ロック時間短縮 |

## セキュリティチェックリスト

### 入力検証

| チェック項目 | 脆弱性 | 対策 | 実装例 |
|-------------|--------|------|--------|
| **SQLインジェクション** | 動的SQL生成 | パラメータ化クエリ | `SELECT * FROM Users WHERE Id = @id` |
| **XSS** | 未エスケープ出力 | HTMLエンコード | `HttpUtility.HtmlEncode(input)` |
| **CSRF** | トークン未検証 | CSRFトークン | `@Html.AntiForgeryToken()` |
| **パストラバーサル** | ファイルパス未検証 | パス正規化 | `Path.GetFullPath(path)` |
| **入力値検証** | 検証なし | 厳密な検証 | データアノテーション |

### 認証・認可

| チェック項目 | リスク | 対策 | 備考 |
|-------------|--------|------|------|
| **パスワード保存** | 平文保存 | ハッシュ化+ソルト | bcrypt, PBKDF2使用 |
| **セッション管理** | 固定セッションID | セッション再生成 | ログイン時に更新 |
| **権限チェック** | 権限未確認 | 適切な認可 | Role-based Access Control |
| **機密情報** | ログ出力 | マスキング | 個人情報の保護 |
| **通信暗号化** | 平文通信 | HTTPS/TLS | 盗聴防止 |

## 保守性チェックリスト

### コメント・ドキュメント

| チェック項目 | 良い例 | 悪い例 | ガイドライン |
|-------------|--------|--------|-------------|
| **XML文書コメント** | `/// <summary>顧客情報を検証する</summary>` | `// 検証` | API仕様を明確に |
| **複雑な処理の説明** | アルゴリズムの解説 | 自明な処理の説明 | 「なぜ」を説明 |
| **TODOコメント** | `// TODO: 例外処理の追加 (Issue #123)` | `// TODO: 修正` | 追跡可能な形式 |
| **廃止予定API** | `[Obsolete("Use NewMethod instead")]` | コメントのみ | 適切な属性使用 |
| **設計意図** | パターンや制約の説明 | 実装詳細 | 設計判断の記録 |

### テスタビリティ

| チェック項目 | 設計 | 利点 | 実装方法 |
|-------------|------|------|----------|
| **依存性注入** | インターフェースを使用 | モック化可能 | DIコンテナ活用 |
| **純粋関数** | 副作用なし | 予測可能 | 関数型アプローチ |
| **静的依存の回避** | インスタンス化 | テスト分離 | ファクトリパターン |
| **時間の抽象化** | IDateTimeProvider | 時間制御可能 | システム時計の注入 |
| **外部リソース** | インターフェース化 | モック化 | Repository パターン |