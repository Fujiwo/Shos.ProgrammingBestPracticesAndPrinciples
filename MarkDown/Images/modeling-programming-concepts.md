# モデリングとしてのプログラミング概念図

## プログラミング = 設計 + 実装 + テスト

```
┌────────────────────────────────────────────────────────────────────┐
│                 プログラミングの統合的活動                         │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐    │
│  │      設計        │  │      実装        │  │     テスト      │    │
│  │ ─────────────── │  │ ─────────────── │  │ ─────────────── │    │
│  │ • 意図の表現     │  │ • 動作の記述     │  │ • 検証可能性    │    │
│  │ • 構造の定義     │  │ • 実行可能性     │  │ • 予測可能性    │    │
│  │ • 責務の分担     │  │ • 効率性の考慮   │  │ • 回帰可能性    │    │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘    │
│           │                      │                      │         │
│           └──────────────────────┼──────────────────────┘         │
│                                  ▼                                │
│                    ┌─────────────────────┐                        │
│                    │ 検証可能な設計/実装  │                        │
│                    │      モデル         │                        │
│                    └─────────────────────┘                        │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

## モデルの階層と抽象化

```
┌────────────────────────────────────────────────────────────────────┐
│                        モデルの階層構造                            │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  概念モデル（Conceptual Model）                                    │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ • ドメインの概念と関係を表現                                  │  │
│  │ • ビジネスルールの定義                                        │  │
│  │ • 実装技術に依存しない抽象化                                  │  │
│  │                                                              │  │
│  │ 例：「顧客」「注文」「商品」の関係                            │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                 │                                  │
│                                 ▼                                  │
│  論理モデル（Logical Model）                                       │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ • 概念モデルの構造化                                          │  │
│  │ • データ構造とプロセスの定義                                  │  │
│  │ • 特定技術への依存度を最小化                                  │  │
│  │                                                              │  │
│  │ 例：Customer クラス、Order クラスの責務定義                   │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                 │                                  │
│                                 ▼                                  │
│  物理モデル（Physical Model）                                      │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ • 具体的な実装技術での表現                                    │  │
│  │ • パフォーマンス最適化                                        │  │
│  │ • 技術制約の考慮                                              │  │
│  │                                                              │  │
│  │ 例：C# コードとしての実装                                     │  │
│  └──────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
```

## Why-What-How の階層

```
┌────────────────────────────────────────────────────────────────────┐
│                     Why-What-How フレームワーク                    │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  WHY（なぜ）- 目的・価値                                           │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ • ビジネス価値の実現                                          │  │
│  │ • ユーザー体験の向上                                          │  │
│  │ • 問題解決の動機                                              │  │
│  │                                                              │  │
│  │ "顧客満足度向上のために注文処理を自動化したい"                │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                 │                                  │
│                                 ▼                                  │
│  WHAT（何を）- 機能・要件                                          │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ • 機能要件の定義                                              │  │
│  │ • 品質要件の明確化                                            │  │
│  │ • インターフェース設計                                        │  │
│  │                                                              │  │
│  │ "注文データを受け取り、在庫確認後に出荷指示を作成する"        │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                 │                                  │
│                                 ▼                                  │
│  HOW（どうやって）- 実装・手段                                     │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │ • 技術選択                                                    │  │
│  │ • アルゴリズム設計                                            │  │
│  │ • データ構造設計                                              │  │
│  │                                                              │  │
│  │ "OrderService クラスで Repository パターンを使用"             │  │
│  └──────────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────────┘
```

## プログラミング言語としてのモデル表現力

### 宣言的 vs 手続き的表現

```
┌────────────────────────────────────────────────────────────────────┐
│                    表現力の比較                                    │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  宣言的（What）                  手続き的（How）                   │
│  ┌─────────────────────┐        ┌─────────────────────┐            │
│  │ 何をしたいかを記述   │        │ どうやるかを記述     │            │
│  │                     │        │                     │            │
│  │ var activeUsers =   │        │ var activeUsers =   │            │
│  │   users             │   VS   │   new List<>();     │            │
│  │     .Where(u =>     │        │ foreach(var u in    │            │
│  │       u.IsActive)   │        │   users) {          │            │
│  │     .ToList();      │        │   if(u.IsActive)    │            │
│  │                     │        │     activeUsers     │            │
│  │ ✓ 意図が明確        │        │       .Add(u);      │            │
│  │ ✓ 簡潔              │        │ }                   │            │
│  │ ✓ 最適化を委任       │        │                     │            │
│  └─────────────────────┘        │ × 実装詳細が露出   │            │
│                                 │ × 冗長              │            │
│                                 │ × エラーの余地      │            │
│                                 └─────────────────────┘            │
└────────────────────────────────────────────────────────────────────┘
```

## モデルとコメントの関係

### 自己文書化コードの実現

```
┌────────────────────────────────────────────────────────────────────┐
│                  コメントが必要な場面                              │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  コードで表現できること        コメントが必要な場面                │
│  ┌─────────────────────┐      ┌─────────────────────┐              │
│  │ • アルゴリズムの流れ │      │ • ビジネスルールの背景│              │
│  │ • データ構造         │      │ • 設計判断の理由     │              │
│  │ • 制御フロー         │      │ • 外部制約の説明     │              │
│  │ • 型と関係           │ →   │ • トリッキーな実装の  │              │
│  │                     │      │   背景説明           │              │
│  │ 実装モデル           │      │ 実装モデル以外の情報  │              │
│  └─────────────────────┘      └─────────────────────┘              │
│                                                                    │
│  良いコメントの例：                                                 │
│  // 銀行の営業時間（9:00-15:00）に合わせて処理を制限               │
│  if (currentTime.Hour < 9 || currentTime.Hour >= 15) {            │
│      throw new BusinessHoursException();                          │
│  }                                                                 │
│                                                                    │
│  悪いコメントの例：                                                 │
│  // iを1増やす                                                     │
│  i++;                                                              │
└────────────────────────────────────────────────────────────────────┘
```

## 抽象化レベルの選択

### 問題に適した抽象化

| 抽象化レベル | 適用場面 | 利点 | 注意点 |
|-------------|----------|------|--------|
| **高レベル** | ビジネスロジック | 意図が明確 | パフォーマンス考慮 |
| **中レベル** | アプリケーションサービス | バランス良好 | 適切な粒度選択 |
| **低レベル** | 最適化が必要な処理 | 高いパフォーマンス | 保守性の懸念 |

### 抽象化の実例

```csharp
// 高レベル抽象化（ビジネス概念を直接表現）
public class CustomerLoyaltyService
{
    public LoyaltyLevel CalculateLoyaltyLevel(Customer customer)
    {
        return customer.PurchaseHistory
            .CalculateTotal()
            .ToLoyaltyLevel();
    }
}

// 中レベル抽象化（実装とバランス）
public class OrderProcessingService
{
    public async Task<ProcessingResult> ProcessAsync(Order order)
    {
        await ValidateOrder(order);
        await ReserveInventory(order);
        await ProcessPayment(order);
        return await CreateShippingLabel(order);
    }
}

// 低レベル抽象化（効率重視）
public static class FastMath
{
    public static int MultiplyBy10(int value)
    {
        return value << 3 + value << 1;  // (value * 8) + (value * 2)
    }
}
```

## モデリングの継続的改善

```
┌────────────────────────────────────────────────────────────────────┐
│                    モデル改善サイクル                              │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│    理解                    表現                    検証             │
│ ┌─────────────┐      ┌─────────────┐      ┌─────────────┐        │
│ │ ドメイン分析 │ →   │ コード実装   │ →   │ テストによる │        │
│ │ 要件理解     │      │ 設計判断     │      │ 動作確認     │        │
│ └─────────────┘      └─────────────┘      └─────────────┘        │
│        ▲                       │                       │          │
│        │                       ▼                       ▼          │
│ ┌─────────────┐      ┌─────────────┐      ┌─────────────┐        │
│ │ 学習・改善   │ ←   │ フィードバック│ ←  │ 使用・運用   │        │
│ │ 知識更新     │      │ 見直し       │      │ 実際の使用   │        │
│ └─────────────┘      └─────────────┘      └─────────────┘        │
│                                                                    │
│ このサイクルを通じて：                                              │
│ • より良いモデルへの継続的改善                                      │
│ • 理解の深化と表現力の向上                                          │
│ • チーム全体でのドメイン知識共有                                    │
└────────────────────────────────────────────────────────────────────┘
```