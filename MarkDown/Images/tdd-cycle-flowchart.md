# テスト駆動開発（TDD）サイクル

```
┌──────────────────────────────────────────────────────────────────────┐
│                        TDDサイクル（Red-Green-Refactor）              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│    ①RED                    ②GREEN                    ③REFACTOR      │
│   ┌─────────┐             ┌─────────┐              ┌─────────┐      │
│   │ 失敗する │    →       │ テストを │     →       │ コードを │      │
│   │ テストを │             │ 通す最小 │              │ 改善する │      │
│   │ 書く     │             │ コード   │              │         │      │
│   └─────────┘             └─────────┘              └─────────┘      │
│        │                      │                         │           │
│        └──────────────────────┼─────────────────────────┘           │
│                               ▼                                     │
│                    ┌─────────────────┐                              │
│                    │ すべてのテストが │                              │
│                    │ 通ることを確認   │                              │
│                    └─────────────────┘                              │
│                               │                                     │
│                               ▼                                     │
│                    ┌─────────────────┐                              │
│                    │ 次の機能へ       │                              │
│                    │ (新しいサイクル) │                              │
│                    └─────────────────┘                              │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│                          詳細なTDDフロー                             │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────────┐                                                    │
│  │ 要件を理解   │                                                    │
│  └──────┬──────┘                                                    │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐    RED フェーズ                                    │
│  │ テストケース │                                                    │
│  │ を設計       │                                                    │
│  └──────┬──────┘                                                    │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐                                                    │
│  │ 失敗するテス │ ← 必ず失敗することを確認                           │
│  │ トを記述     │                                                    │
│  └──────┬──────┘                                                    │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐    GREEN フェーズ                                  │
│  │ 最小限の実装 │                                                    │
│  │ でテスト通過 │ ← 「最小限」が重要                                 │
│  └──────┬──────┘                                                    │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐                                                    │
│  │ すべてのテス │                                                    │
│  │ ト実行・確認 │                                                    │
│  └──────┬──────┘                                                    │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐    REFACTOR フェーズ                               │
│  │ コード改善   │                                                    │
│  │ (設計改善)   │ ← テストの保護下で安全にリファクタリング             │
│  └──────┬──────┘                                                    │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐                                                    │
│  │ テスト再実行 │                                                    │
│  │ ・確認       │                                                    │
│  └──────┬──────┘                                                    │
│         │                                                           │
│         ▼                                                           │
│  ┌─────────────┐                                                    │
│  │ 完了？       │ ──No──┐                                           │
│  └──────┬──────┘       │                                           │
│         │Yes            │                                           │
│         ▼               │                                           │
│  ┌─────────────┐       │                                           │
│  │ 次の機能     │       │                                           │
│  └─────────────┘       │                                           │
│                         │                                           │
│         ┌───────────────┘                                           │
│         ▼                                                           │
│  ┌─────────────┐                                                    │
│  │ 新しいテスト │                                                    │
│  │ ケースへ     │                                                    │
│  └─────────────┘                                                    │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│                           TDDの効果                                  │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ✓ テスト可能な設計の自然な実現                                      │
│  ✓ 要件の明確化と仕様書としてのテスト                                │
│  ✓ リファクタリング時の安全性確保                                    │
│  ✓ 必要最小限の実装（YAGNI原則の実践）                              │
│  ✓ 早期のバグ発見と品質向上                                          │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```