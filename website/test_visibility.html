<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mermaid Visibility Test</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        h1, h2 {
            color: #333;
        }
    </style>
</head>
<body>
    <h1>Mermaid クラス図の可視性テスト</h1>
    
    <div class="test-section">
        <h2>改善後のクラス図（明るい背景色）</h2>
        <div class="content">
            <pre class="mermaid">
classDiagram
    class Controller {
        +Command Command
        +Model Model
        +MouseDown(Point location)
        +MouseUp(Point location)
    }
    class Command {
        <<abstract>>
        +OnDragStart(Model model, Point location)
        +OnDragEnd(Model model, Point location)
    }
    class AddLineCommand {
        +OnDragStart(Model model, Point location)
        +OnDragEnd(Model model, Point location)
    }
    class AddRectangleCommand {
        +OnDragStart(Model model, Point location)
        +OnDragEnd(Model model, Point location)
    }
    
    Controller --> Command : uses
    Command <|-- AddLineCommand : inherits
    Command <|-- AddRectangleCommand : inherits
    AddLineCommand --> Line : creates
    AddRectangleCommand --> Rectangle : creates
            </pre>
        </div>
    </div>

    <div class="test-section">
        <h2>複雑なクラス図の例</h2>
        <div class="content">
            <pre class="mermaid">
classDiagram
    class Order {
        +OrderId Id
        +CustomerId CustomerId
        +DateTime CreatedDate
        +OrderStatus Status
        +Money Total
        +AddItem(Product product, int quantity)
        +RemoveItem(ProductId productId)
        +Confirm()
    }
    
    class OrderItem {
        +ProductId ProductId
        +string ProductName
        +Money UnitPrice
        +int Quantity
        +Money LineTotal
        +UpdateQuantity(int newQuantity)
    }
    
    class Customer {
        +CustomerId Id
        +string Name
        +EmailAddress Email
        +CustomerType Type
        +UpgradeToMember(CustomerType newType)
    }
    
    class PaymentProcessor {
        <<interface>>
        +ProcessAsync(PaymentRequest request)
        +PaymentMethod SupportedMethod
    }
    
    class CreditCardPaymentProcessor {
        +ProcessAsync(PaymentRequest request)
        +PaymentMethod SupportedMethod
    }
    
    class PayPalPaymentProcessor {
        +ProcessAsync(PaymentRequest request)
        +PaymentMethod SupportedMethod
    }
    
    Order "1" *-- "many" OrderItem : contains
    Order --> Customer : belongs to
    Order --> PaymentProcessor : uses
    PaymentProcessor <|-- CreditCardPaymentProcessor : implements
    PaymentProcessor <|-- PayPalPaymentProcessor : implements
            </pre>
        </div>
    </div>

    <script type="module">
        try {
            // CDNが使えない場合のローカルテスト用のモック
            if (typeof window.mermaid === 'undefined') {
                window.mermaid = {
                    init: () => {
                        console.log('Mermaid mock initialized');
                        document.querySelectorAll('.mermaid').forEach((el, i) => {
                            el.innerHTML = `<div style="border: 2px solid #000; padding: 20px; background: #f9f9f9; border-radius: 8px;">
                                <strong>改善されたMermaid図 ${i + 1}</strong><br>
                                <div style="margin-top: 10px; padding: 10px; background: #fff; border: 1px solid #ddd;">
                                    <pre style="background: none; margin: 0;">${el.textContent}</pre>
                                </div>
                            </div>`;
                        });
                    },
                    run: async () => {
                        window.mermaid.init();
                    }
                };
            }

            const mermaid = await import('https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs').catch(() => null);
            
            if (mermaid) {
                const config = { 
                    startOnLoad: false,
                    theme: 'default',
                    securityLevel: 'loose',
                    themeVariables: {
                        // クラス図の背景色を明るくして線を見やすくする
                        primaryColor: '#f9f9f9',          // クラスボックスの背景色を明るくする
                        primaryTextColor: '#333333',      // テキストの色を濃くして可読性を向上
                        primaryBorderColor: '#000000',    // 境界線を黒くして明確にする
                        lineColor: '#000000',             // 線の色を黒くして見やすくする
                        secondaryColor: '#ffffff',        // セカンダリ背景色を白にする
                        tertiaryColor: '#f0f0f0',         // ターシャリ背景色を明るいグレーにする
                        background: '#ffffff',            // 全体の背景色を白にする
                        fontFamily: 'Arial, sans-serif', // フォントファミリーを設定
                        fontSize: '14px'                  // フォントサイズを設定
                    }
                };
                
                mermaid.default.initialize(config);
                window.mermaid = mermaid.default;
                
                setTimeout(async () => {
                    const elements = document.querySelectorAll('.mermaid');
                    console.log('Found mermaid elements:', elements.length);
                    if (mermaid.default.run) {
                        await mermaid.default.run({ nodes: elements });
                    } else {
                        mermaid.default.init(undefined, elements);
                    }
                }, 1000);
            } else {
                // CDNが利用できない場合はモック表示
                console.log('Using mock mermaid');
                window.mermaid.init();
            }
        } catch (e) {
            console.log('Mermaid loading error:', e);
            // フォールバック表示
            document.querySelectorAll('.mermaid').forEach((el, i) => {
                el.innerHTML = `<div style="border: 2px solid #667eea; padding: 20px; background: #f9f9f9; border-radius: 8px;">
                    <strong>テスト用Mermaid図 ${i + 1}（改善済み背景色）</strong><br>
                    <div style="margin-top: 10px; padding: 10px; background: #fff; border: 1px solid #000;">
                        クラス図の背景色が明るくなり、線がより見やすくなりました。
                        <pre style="background: none; margin: 10px 0; font-size: 12px;">${el.textContent}</pre>
                    </div>
                </div>`;
            });
        }
    </script>
</body>
</html>